# Prueba 2 - Análisis de datos
# En el archivo Data_sessions_flujo_de_compra.xlsx encontrara un dataset del flujo de compra de 
# usuarios en los meses comprendidos entre enero y agosto. Se debe realizar un análisis de estos 
# datos marcando patrones y diferencias dentro del flujo de compra por tipo de plataforma y por país.
 
# El resultado debe ser un archivo pdf. 
# * Es deseado pero no obligatorio que el resultado sea un jupyter notebook.

# initial page: cantidad de gente que entro a la página inicial
# results page: cantidad de gente que hizo búsqueda
# profile page: cantidad de gente que entro a la página de un restaurant
# checkout: cantidad de gente que selecciono comida y fue a pagar
# order placed: cantidad de órdenes que se realizaron

library(tidyverse)
library(janitor)

data <- readxl::read_xlsx("~/personales/pedidosya/data/Data_sesiones_flujo_de_compra.xlsx") %>% 
  janitor::clean_names() %>% 
  separate(country_name_platform, c("country", "platform"))

## Por tipo de plataforma

# La tasa de conversión es el porcentaje de visitas que se convierten en ventas.

plataforma <- data %>% 
  group_by(platform) %>% 
  summarise(initial_page = sum(initial_page),
            results_page = sum(results_page),
            profile_page = sum(profile_page),
            checkout = sum(checkout),
            order_placed = sum(order_placed)) %>% 
  ungroup() 

tabla_1 <- plataforma %>% 
  adorn_totals("row") %>% 
  adorn_percentages(denominator = "col") %>% 
  adorn_pct_formatting(digits = 0) %>% 
  adorn_ns(position = "front")

tabla_2 <- plataforma %>% 
  mutate(tc = round((order_placed/initial_page)*100, 1),
         tc_2 = round((order_placed/results_page)*100, 1),
         tc_3 = round((order_placed/checkout)*100, 1)) %>% 
  select(platform, starts_with("tc"))

## Por país

pais <- data %>% 
  group_by(country) %>% 
  summarise(initial_page = sum(initial_page),
            results_page = sum(results_page),
            profile_page = sum(profile_page),
            checkout = sum(checkout),
            order_placed = sum(order_placed)) %>% 
  ungroup() 

tabla_3 <- pais %>% 
  adorn_totals("row") %>% 
  adorn_percentages(denominator = "col") %>% 
  adorn_pct_formatting(digits = 0) %>% 
  adorn_ns(position = "front")

tabla_4 <- pais %>% 
  mutate(tc = round((order_placed/initial_page)*100, 1),
         tc_2 = round((order_placed/results_page)*100, 1),
         tc_3 = round((order_placed/checkout)*100, 1)) %>% 
  select(country, starts_with("tc"))
